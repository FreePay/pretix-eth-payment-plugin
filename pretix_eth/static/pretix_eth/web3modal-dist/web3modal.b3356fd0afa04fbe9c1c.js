(()=>{"use strict";const e={paymentDetails:null,transactionHashSubmitted:!1,lastOrderStatus:"",elements:{divError:document.getElementById("message-error"),divSuccess:document.getElementById("success"),divTransactionHash:document.getElementById("pretix-eth-transaction-hash"),aOrderDetailURL:document.getElementById("pretix-order-detail-url"),buttonPay:document.getElementById("btn-pay"),submittedTransactionHash:document.getElementById("pretix-eth-submitted-transaction-hash")},selectors:{paymentSteps:document.querySelectorAll(".pretix-eth-payment-steps")}};function t(){return e.elements.buttonPay.getAttribute("data-transaction-details-url")}function n(e){e+="=";const t=decodeURIComponent(document.cookie).split(";");for(let n=0;n<t.length;n++){const a=t[n].trim();if(0==a.indexOf(e))return a.substring(e.length,a.length)}}function a(t="",n=!0){e.transactionHashSubmitted?(t="",n=!1):("object"==typeof t&&(t=t.data&&t.data.message?t.data.message+". Please try again.":void 0!==t.message?t.message+". Please try again.":void 0!==t.error&&void 0!==t.error.message?t.error.message+". Please try again.":""),""===t&&(t="There was an error, please try again, or contact support if you have already confirmed a payment in your wallet provider.")),e.elements.divError.innerHTML=t,!0===n&&r("pay");try{e.elements.buttonPay.removeAttribute("disabled")}catch(e){return!1}return!1}function r(t){e.selectors.paymentSteps.forEach((function(e){e.id===t?e.style.display="block":e.style.display="none"}))}async function o(){let t=e.elements.aOrderDetailURL.getAttribute("data-order-detail-url");const a=n("pretix_csrftoken");let r=await fetch(t,{headers:{"X-CSRF-TOKEN":a,"HTTP-X-CSRFTOKEN":a}});if(r.ok){let t=await r.json();""===e.lastOrderStatus?e.lastOrderStatus=t.status:e.lastOrderStatus!==t.status&&"p"===t.status&&location.reload()}}let i;async function s(){e.elements.divError.innerHTML="";try{await async function(){e.paymentDetails=await async function(n=!1){if(!n&&null!==e.paymentDetails)return e.paymentDetails;const a=await fetch(t());if(a.status>=400)throw"Failed to fetch order details. If this problem persists, please contact the organizer directly.";return await a.json()}(!0),!0!==e.paymentDetails.is_signature_submitted?function({tcBaseUrl:e,paymentLogicalAssetAmountInUsd:t,primaryCurrency:n,usdPerEth:a,onCheckout:r}){const o="3cities-iframe-container";!function({tcOrigin:e,onCheckout:t,onCloseIframe:n}){i&&(window.removeEventListener("message",i,!0),i=void 0),i=a=>{a.origin===e&&(null!==a&&"object"==typeof a&&null!==a.data&&"object"==typeof a.data?"Checkout"===a.data.kind?t(a.data):"CloseIframe"===a.data.kind?n():console.error("Unexpected kind of event from 3cities, kind=",a.data.kind):console.error("Unexpected event from 3cities",a))},window.addEventListener("message",i,!0)}({tcOrigin:new URL(e).origin,onCheckout:r,onCloseIframe:()=>{!function(e){const t=document.getElementById(e);t&&t.remove()}(o)}});const s='Standalone page detected. Please use the "Click here to pay" pop-up in Pretix',c=window.location.origin,d={verifyEip1271Signature:!0},l="Return to Ticket Shop",u=(()=>{const r=[e];return r.push(`&amount=${encodeURIComponent(t)}`),r.push(`&currency=${encodeURIComponent(n)}`),r.push(`&usdPerEth=${encodeURIComponent(a)}`),s&&r.push(`&requireInIframeOrErrorWith=${encodeURIComponent(s)}`),c&&r.push(`&iframeParentWindowOrigin=${encodeURIComponent(c)}`),d&&(r.push("&authenticateSenderAddress=1"),d.verifyEip1271Signature&&r.push("&verifyEip1271Signature=1")),l&&r.push(`&clickToCloseIframeLabel=${encodeURIComponent(l)}`),r.push("&requireNativeTokenTransferProxy=1"),r.join("")})();var p,m;p=o,m=u,function(){let e=document.createElement("div");e.id=p,e.style="position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;",e.onclick=function(n){n.target===e&&t()};let t=function(){document.body.contains(e)&&(document.body.removeChild(e),document.removeEventListener("keydown",n))},n=function(e){"Escape"===e.key&&t()};document.addEventListener("keydown",n);let a=document.createElement("div"),r=window.innerWidth<481?window.innerWidth-30+"px":"451px";a.style="background-color:#f1f1f1;padding:8px;width:100%;max-width:"+r+";height:95vh;max-height:1024px;border-radius:10px;position:relative;box-shadow:0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);margin:auto;";let o=document.createElement("iframe");o.allow="clipboard-write",o.style="width:100%;height:100%;border:0;",o.src=m;let i=document.createElement("div");i.style="position:absolute;top:5px;right:5px;width:24px;height:24px;cursor:pointer;z-index:10;",i.innerHTML="<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='currentColor' style='width:100%;height:100%;'><path fill-rule='evenodd' clip-rule='evenodd' d='M10 9.293l5.146-5.147a.5.5 0 01.708.708L10.707 10l5.147 5.146a.5.5 0 01-.708.708L10 10.707l-5.146 5.147a.5.5 0 01-.708-.708L9.293 10 4.146 4.854a.5.5 0 11.708-.708L10 9.293z'></path></svg>",i.onclick=function(){t()},a.appendChild(o),a.appendChild(i),e.appendChild(a),document.body.appendChild(e)}()}({tcBaseUrl:"https://staging.3cities.xyz/#/pay?c=CAESFKwNd1PqKBZQG1f66a1mVzkBg4SzIgICASoCARA6K0VUSCBXRVRIIFVTREMgREFJIFVTRFAgR1VTRCBMVVNEIFBZVVNEIFVTRFQ",paymentLogicalAssetAmountInUsd:e.paymentDetails.amount,primaryCurrency:e.paymentDetails.primary_currency,usdPerEth:e.paymentDetails.usd_per_eth,onCheckout:c}):a("It seems that you have paid for this order already.")}()}catch(e){console.error("Pay flow error:",e),a(e,!0)}}async function c(i){try{await async function(i){const s=n("pretix_csrftoken"),c=t(),d=new URLSearchParams({csrfmiddlewaretoken:s,senderAddress:i.caip222StyleMessageThatWasSigned.senderAddress,signature:i.caip222StyleSignature,message:JSON.stringify(i.caip222StyleMessageThatWasSigned),transactionHash:i.transactionHash,chainId:i.chainId});fetch(c,{headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-TOKEN":s,"HTTP-X-CSRFTOKEN":s},method:"POST",body:d}).then((async t=>{t.ok?(function(t){e.transactionHashSubmitted=!0,e.elements.divTransactionHash.innerHTML=`${t.transactionHash} (chain ID ${t.chainId})`,r(),e.elements.divSuccess.style.display="block"}(i),await async function(){for(;;){try{await o()}catch(e){}await new Promise((e=>setTimeout(e,5e3)))}}()):a(`There was an error processing your payment, please contact support. Your payment was sent in transaction ${i.transactionHash} on chainId ${i.chainId}.`,!1)}))}(i)}catch(e){a(e,!0)}}!async function(){document.title="Pretix Payment",document.getElementById("spinner").style.display="none";const e=document.getElementById("btn-pay");e?e.addEventListener("click",s):console.error("No pay button found")}()})();
//# sourceMappingURL=web3modal.b3356fd0afa04fbe9c1c.js.map