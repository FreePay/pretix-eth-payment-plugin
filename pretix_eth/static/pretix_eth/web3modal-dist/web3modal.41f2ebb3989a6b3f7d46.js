(()=>{"use strict";const e={paymentDetails:null,transactionHashSubmitted:!1,lastOrderStatus:"",elements:{divError:document.getElementById("message-error"),divSuccess:document.getElementById("success"),divTransactionHash:document.getElementById("pretix-eth-transaction-hash"),aOrderDetailURL:document.getElementById("pretix-order-detail-url"),buttonPay:document.getElementById("btn-pay"),submittedTransactionHash:document.getElementById("pretix-eth-submitted-transaction-hash")},selectors:{paymentSteps:document.querySelectorAll(".pretix-eth-payment-steps")}};function t(){return e.elements.buttonPay.getAttribute("data-transaction-details-url")}function n(e){e+="=";const t=decodeURIComponent(document.cookie).split(";");for(let n=0;n<t.length;n++){const a=t[n].trim();if(0==a.indexOf(e))return a.substring(e.length,a.length)}}function a(t="",n=!0){e.transactionHashSubmitted?(t="",n=!1):("object"==typeof t&&(t=t.data&&t.data.message?t.data.message+". Please try again.":void 0!==t.message?t.message+". Please try again.":void 0!==t.error&&void 0!==t.error.message?t.error.message+". Please try again.":""),""===t&&(t="There was an error, please try again, or contact support if you have already confirmed a payment in your wallet provider.")),e.elements.divError.innerHTML=t,!0===n&&r("pay");try{e.elements.buttonPay.removeAttribute("disabled")}catch(e){return!1}return!1}function r(t){e.selectors.paymentSteps.forEach((function(e){e.id===t?e.style.display="block":e.style.display="none"}))}async function o(){let t=e.elements.aOrderDetailURL.getAttribute("data-order-detail-url");const a=n("pretix_csrftoken");let r=await fetch(t,{headers:{"X-CSRF-TOKEN":a,"HTTP-X-CSRFTOKEN":a}});if(r.ok){let t=await r.json();""===e.lastOrderStatus?e.lastOrderStatus=t.status:e.lastOrderStatus!==t.status&&"p"===t.status&&location.reload()}}let i;async function s(){e.elements.divError.innerHTML="";try{await async function(){e.paymentDetails=await async function(n=!1){if(!n&&null!==e.paymentDetails)return e.paymentDetails;const a=await fetch(t());if(a.status>=400)throw"Failed to fetch order details. If this problem persists, please contact the organizer directly.";return await a.json()}(!0),!0!==e.paymentDetails.is_signature_submitted?function({tcBaseUrl:e,receiverAddress:t,paymentLogicalAssetAmountInUsd:n,primaryCurrency:a,usdPerEth:r,onTransactionSigned:o}){const s="3cities-iframe-container";!function({tcOrigin:e,onTransactionSigned:t,onCloseIframe:n}){i&&(window.removeEventListener("message",i,!0),i=void 0),i=a=>{a.origin===e&&(null!==a&&"object"==typeof a&&null!==a.data&&"object"==typeof a.data?"TransactionSigned"===a.data.kind?t(a.data):"CloseIframe"===a.data.kind?n():"Checkout"===a.data.kind||console.error("Unexpected kind of event from 3cities, kind=",a.data.kind):console.error("Unexpected event from 3cities",a))},window.addEventListener("message",i,!0)}({tcOrigin:new URL(e).origin,onTransactionSigned:o,onCloseIframe:()=>{!function(e){const t=document.getElementById(e);t&&t.remove()}(s)}});const c='Standalone page detected. Please use the "Click here to pay" pop-up in Pretix',d=window.location.origin,l={verifyEip1271Signature:!0},p="Return to Ticket Shop",u=(()=>{const o=[e];return o.push(`&receiverAddress=${encodeURIComponent(t)}`),o.push(`&amount=${encodeURIComponent(n)}`),o.push(`&currency=${encodeURIComponent(a)}`),o.push(`&usdPerEth=${encodeURIComponent(r)}`),c&&o.push(`&requireInIframeOrErrorWith=${encodeURIComponent(c)}`),d&&o.push(`&iframeParentWindowOrigin=${encodeURIComponent(d)}`),l&&(o.push("&authenticateSenderAddress=1"),l.verifyEip1271Signature&&o.push("&verifyEip1271Signature=1")),p&&o.push(`&clickToCloseIframeLabel=${encodeURIComponent(p)}`),o.push("&requireNativeTokenTransferProxy=1"),o.join("")})();var m,h;m=s,h=u,function(){let e=document.createElement("div");e.id=m,e.style="position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;",e.onclick=function(n){n.target===e&&t()};let t=function(){document.body.contains(e)&&(document.body.removeChild(e),document.removeEventListener("keydown",n))},n=function(e){"Escape"===e.key&&t()};document.addEventListener("keydown",n);let a=document.createElement("div"),r=window.innerWidth<481?window.innerWidth-30+"px":"451px";a.style="background-color:#f1f1f1;padding:8px;width:100%;max-width:"+r+";height:95vh;max-height:1024px;border-radius:10px;position:relative;box-shadow:0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);margin:auto;";let o=document.createElement("iframe");o.allow="clipboard-write",o.style="width:100%;height:100%;border:0;",o.src=h;let i=document.createElement("div");i.style="position:absolute;top:5px;right:5px;width:24px;height:24px;cursor:pointer;z-index:10;",i.innerHTML="<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='currentColor' style='width:100%;height:100%;'><path fill-rule='evenodd' clip-rule='evenodd' d='M10 9.293l5.146-5.147a.5.5 0 01.708.708L10.707 10l5.147 5.146a.5.5 0 01-.708.708L10 10.707l-5.146 5.147a.5.5 0 01-.708-.708L9.293 10 4.146 4.854a.5.5 0 11.708-.708L10 9.293z'></path></svg>",i.onclick=function(){t()},a.appendChild(o),a.appendChild(i),e.appendChild(a),document.body.appendChild(e)}()}({tcBaseUrl:"https://3cities.xyz/#/pay?c=CAESFGdAb29187sroN7d8mdtO6b1XHAPIgICASoCARA6DEVUSCBXRVRIIERBSUowAQoBAAoEAgEGAQoIBAUDCgUDBAMFAgoHBwcHBwcHCgUJAQQECggBBAUHCgMEBAQD",receiverAddress:e.paymentDetails.recipient_address,paymentLogicalAssetAmountInUsd:e.paymentDetails.amount,primaryCurrency:e.paymentDetails.primary_currency,usdPerEth:e.paymentDetails.usd_per_eth,onTransactionSigned:c}):a("It seems that you have paid for this order already.")}()}catch(e){console.error("Pay flow error:",e),a(e,!0)}}async function c(i){try{await async function(i){const s=n("pretix_csrftoken")||n("__Host-pretix_csrftoken"),c=t(),d=new URLSearchParams({csrfmiddlewaretoken:s,senderAddress:i.caip222StyleMessageThatWasSigned.senderAddress,signature:i.caip222StyleSignature,message:JSON.stringify(i.caip222StyleMessageThatWasSigned),transactionHash:i.transactionHash,chainId:i.chainId,tokenTicker:i.tokenTicker,tokenName:i.tokenName,tokenAmount:i.tokenAmount,tokenDecimals:i.tokenDecimals});void 0!==i.receiptUrl&&d.append("receiptUrl",i.receiptUrl),void 0!==i.tokenCurrency&&d.append("tokenCurrency",i.tokenCurrency),void 0!==i.tokenContractAddress&&d.append("tokenContractAddress",i.tokenContractAddress),void 0!==i.chainName&&d.append("chainName",i.chainName),void 0!==i.isTestnet&&d.append("isTestnet",i.isTestnet),async function t(n,s,c=1){const d=Math.min(3e5,1500*Math.pow(2,c));try{if(!(await fetch(n,s)).ok)throw new Error("Response not OK");a(" ",!1),function(t){e.transactionHashSubmitted=!0,e.elements.divTransactionHash.innerHTML=`${t.transactionHash} on ${t.chainName} (chain ID ${t.chainId}) <a href="${t.receiptUrl}" target="_blank">receipt</a>`,r(),e.elements.divSuccess.style.display="block"}(i),await async function(){for(;;){try{await o()}catch(e){}await new Promise((e=>setTimeout(e,5e3)))}}()}catch(e){a(`Do not close this window yet! There was an error processing your payment. We will re-try shortly. If this error does not go away, please contact support. Save these details: Your payment was sent in transaction ${i.transactionHash} on ${i.chainName} (chain ID ${i.chainId}). Receipt link ${i.receiptUrl}.`,!1),setTimeout((()=>t(n,s,c+1)),d)}}(c,{headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRFToken":s},method:"POST",mode:"same-origin",body:d})}(i)}catch(e){a(e,!0)}}!async function(){document.title="Pretix Payment",document.getElementById("spinner").style.display="none";const e=document.getElementById("btn-pay");e?e.addEventListener("click",s):console.error("No pay button found")}()})();
//# sourceMappingURL=web3modal.41f2ebb3989a6b3f7d46.js.map